import{highlightSearchTerm}from"./highlight-search-term.js";document.addEventListener("DOMContentLoaded",function(){const e=(e,t=[])=>{document.querySelectorAll(".bibliography, .unloaded").forEach(e=>e.classList.remove("unloaded"));const n=e.toLowerCase(),o=n.length>0,a=t.length>0;if(document.querySelectorAll(".bibliography > li").forEach(e=>{let l=!0,i=!0;if(o){l=-1!==e.innerText.toLowerCase().indexOf(n)}if(a){const n=e.querySelector("[data-tags]");if(n){const e=n.getAttribute("data-tags");if(e){const n=e.split(",").map(e=>e.trim().toLowerCase());i=t.some(e=>n.some(t=>t===e.toLowerCase()))}else i=!1}else i=!1}l&&i||e.classList.add("unloaded")}),CSS.highlights&&o)highlightSearchTerm({search:n,selector:".bibliography > li:not(.unloaded)"});document.querySelectorAll("h2.bibliography").forEach(function(e){let t=e.nextElementSibling,n=!0;for(;t&&"H2"!==t.tagName;){if("OL"===t.tagName){const e=t,o=e.querySelectorAll(":scope > li.unloaded"),a=e.querySelectorAll(":scope > li");o.length===a.length?(e.previousElementSibling.classList.add("unloaded"),e.classList.add("unloaded")):n=!1}t=t.nextElementSibling}n&&e.classList.add("unloaded")})},t=()=>{const e=new Set;return document.querySelectorAll("[data-tags]").forEach(t=>{const n=t.getAttribute("data-tags");n&&n.split(",").forEach(t=>{e.add(t.trim().toLowerCase())})}),Array.from(e).sort()},n=()=>{const e=t();if(0===e.length)return;const n=document.getElementById("tag-filters");n&&(n.innerHTML="",e.forEach(e=>{const t=document.createElement("button");t.className="tag-filter btn btn-sm btn-outline-secondary mr-2 mb-2",t.textContent=e,t.setAttribute("data-tag",e),t.addEventListener("click",function(){this.classList.toggle("active"),a()}),n.appendChild(t)}))},o=()=>Array.from(document.querySelectorAll(".tag-filter.active")).map(e=>e.getAttribute("data-tag")),a=()=>{const t=document.getElementById("bibsearch").value,n=o();e(t,n)},l=()=>{const e=decodeURIComponent(window.location.hash.substring(1));document.getElementById("bibsearch").value=e,a()};let i;n(),document.getElementById("bibsearch").addEventListener("input",function(){clearTimeout(i),i=setTimeout(a,300)}),window.addEventListener("hashchange",l),l()});