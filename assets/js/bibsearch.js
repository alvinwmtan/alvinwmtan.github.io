import{highlightSearchTerm}from"./highlight-search-term.js";document.addEventListener("DOMContentLoaded",function(){const e=(e,t=[])=>{document.querySelectorAll(".bibliography, .unloaded").forEach(e=>e.classList.remove("unloaded"));const o=e.toLowerCase(),n=o.length>0,a=t.length>0;if(document.querySelectorAll(".bibliography > li").forEach(e=>{let l=!0,i=!0;if(n){l=-1!==e.innerText.toLowerCase().indexOf(o)}if(a){const o=e.querySelector("[data-tags]");if(o){const e=o.getAttribute("data-tags");if(e){const o=e.split(",").map(e=>e.trim().toLowerCase());i=t.some(e=>o.some(t=>t===e.toLowerCase()))}else i=!1}else i=!1}l&&i||e.classList.add("unloaded")}),CSS.highlights&&n)highlightSearchTerm({search:o,selector:".bibliography > li:not(.unloaded)"});document.querySelectorAll("h2.bibliography").forEach(function(e){let t=e.nextElementSibling,o=!0;for(;t&&"H2"!==t.tagName;){if("OL"===t.tagName){const e=t,n=e.querySelectorAll(":scope > li.unloaded"),a=e.querySelectorAll(":scope > li");n.length===a.length?(e.previousElementSibling.classList.add("unloaded"),e.classList.add("unloaded")):o=!1}t=t.nextElementSibling}o&&e.classList.add("unloaded")})},t=()=>{const e=new Set;return document.querySelectorAll("[data-tags]").forEach(t=>{const o=t.getAttribute("data-tags");o&&o.split(",").forEach(t=>{e.add(t.trim().toLowerCase())})}),Array.from(e).sort()},o=()=>{const e=t();if(0===e.length)return;const o=document.getElementById("tag-filters");o&&(o.innerHTML="",e.forEach(e=>{const t=document.createElement("button");t.className="tag-filter btn btn-sm mr-2 mb-2",t.textContent=e,t.setAttribute("data-tag",e),t.addEventListener("click",function(){this.classList.toggle("active"),a()}),o.appendChild(t)}))},n=()=>Array.from(document.querySelectorAll(".tag-filter.active")).map(e=>e.getAttribute("data-tag")),a=()=>{const t=document.getElementById("bibsearch").value,o=n();e(t,o)},l=()=>{const e=decodeURIComponent(window.location.hash.substring(1));document.getElementById("bibsearch").value=e,a()};let i;o(),document.getElementById("bibsearch").addEventListener("input",function(){clearTimeout(i),i=setTimeout(a,300)}),window.addEventListener("hashchange",l),l()});