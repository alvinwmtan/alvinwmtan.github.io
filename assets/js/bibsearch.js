function tagColorIndex(t){let e=0;const o=String(t).toLowerCase();for(let t=0;t<o.length;t++)e=31*e+o.charCodeAt(t)>>>0;return e%TAG_COLOR_COUNT}function applyTagColors(){document.querySelectorAll(".publications .tags .tag").forEach(t=>{const e=tagColorIndex(t.getAttribute("data-tag")||t.textContent.trim());t.classList.add("tag-color-"+e)})}import{highlightSearchTerm}from"./highlight-search-term.js";const TAG_COLOR_COUNT=12;document.addEventListener("DOMContentLoaded",function(){applyTagColors();const t=(t,e=[])=>{document.querySelectorAll(".bibliography, .unloaded").forEach(t=>t.classList.remove("unloaded"));const o=t.toLowerCase(),a=o.length>0,n=e.length>0;if(document.querySelectorAll(".bibliography > li").forEach(t=>{let l=!0,r=!0;if(a){l=-1!==t.innerText.toLowerCase().indexOf(o)}if(n){const o=t.querySelector("[data-tags]");if(o){const t=o.getAttribute("data-tags");if(t){const o=t.split(",").map(t=>t.trim().toLowerCase());r=e.some(t=>o.some(e=>e===t.toLowerCase()))}else r=!1}else r=!1}l&&r||t.classList.add("unloaded")}),CSS.highlights&&a)highlightSearchTerm({search:o,selector:".bibliography > li:not(.unloaded)"});document.querySelectorAll("h2.bibliography").forEach(function(t){let e=t.nextElementSibling,o=!0;for(;e&&"H2"!==e.tagName;){if("OL"===e.tagName){const t=e,a=t.querySelectorAll(":scope > li.unloaded"),n=t.querySelectorAll(":scope > li");a.length===n.length?(t.previousElementSibling.classList.add("unloaded"),t.classList.add("unloaded")):o=!1}e=e.nextElementSibling}o&&t.classList.add("unloaded")})},e=()=>{const t=new Set;return document.querySelectorAll("[data-tags]").forEach(e=>{const o=e.getAttribute("data-tags");o&&o.split(",").forEach(e=>{t.add(e.trim().toLowerCase())})}),Array.from(t).sort()},o=()=>{const t=e();if(0===t.length)return;const o=document.getElementById("tag-filters");o&&(o.innerHTML="",t.forEach(t=>{const e=document.createElement("button"),a="tag-color-"+tagColorIndex(t);e.className="tag-filter btn btn-sm mr-2 mb-2 "+a,e.textContent=t,e.setAttribute("data-tag",t),e.addEventListener("click",function(){this.classList.toggle("active"),n()}),o.appendChild(e)}))},a=()=>Array.from(document.querySelectorAll(".tag-filter.active")).map(t=>t.getAttribute("data-tag")),n=()=>{const e=document.getElementById("bibsearch").value,o=a();t(e,o)},l=()=>{const t=decodeURIComponent(window.location.hash.substring(1));document.getElementById("bibsearch").value=t,n()};let r;o(),document.getElementById("bibsearch").addEventListener("input",function(){clearTimeout(r),r=setTimeout(n,300)}),window.addEventListener("hashchange",l),l()});